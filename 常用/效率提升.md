
# 一、日志搜索

这是后端开发的核心调试技能。其核心哲学是：**“过滤重于阅读”**。不要试图用眼睛逐行扫描，要用工具把你要的内容“揪”出来。

### 核心武器：Linux 终端下的文本处理三剑客

这些命令在生产服务器（Linux）上绝对可用，而且功能强大无比。

#### 1. `grep` - 全局搜索过滤（最常用）
`grep` 用于搜索**包含特定模式（字符串、正则表达式）的行**。

*   **基础用法**：
    ```bash
    # 在 file.log 中搜索所有包含 "ERROR" 的行
    grep "ERROR" file.log

    # 实时跟踪日志并过滤（-f 表示 follow）
    tail -f application.log | grep "TimeoutException"

    # 忽略大小写搜索（-i）
    grep -i "error" file.log

    # 显示匹配行的前后各3行上下文（-C 3）
    grep -C 3 "NullPointerException" file.log

    # 显示匹配行的行号（-n）
    grep -n "user id: 12345" file.log
    ```

*   **高级用法（正则表达式）**：
    ```bash
    # 搜索以 "2024-05-" 开头的行（通常是日志日期）
    grep "^2024-05-" file.log

    # 搜索包含 "ERROR" 或 "WARN" 的行（| 表示或，-E 启用扩展正则）
    grep -E "ERROR|WARN" file.log

    # 搜索一个特定交易ID的所有日志
    grep "txn-id-abc123" file.log
    ```

#### 2.  `less` - 分页查看器
当文件太大，`cat` 命令会刷屏看不到开头，用 `less`。

*   **用法**：`less application.log`
*   **`less` 内部命令（进入后使用）**：
    *   `/keyword` -> **向前搜索** `keyword`，按 `n` 下一个，`N` 上一个。
    *   `?keyword` -> **向后搜索** `keyword`。
    *   `G` -> 跳转到文件**末尾**（大写的G）。
    *   `gg` -> 跳转到文件**开头**。
    *   `q` -> 退出 `less`。

#### 3.  `tail` / `head` - 查看首尾
*   `tail -n 100 application.log` -> 查看日志**最后100行**。
*   `tail -f application.log` -> **实时跟踪**日志输出，这是看线上日志最最常用的命令！
*   `head -n 50 application.log` -> 查看日志**前50行**。

#### 4. 其他

**1.  `awk` - 强大的文本分析工具（处理结构化日志）**
如果你的日志格式比较规整（例如用 `|` 或空格分隔），`awk` 是神器。
```bash
# 假设日志格式：日期 级别 消息
# 打印出第一列（日期）和第三列（消息）
awk '{print $1, $3}' application.log

# 只打印级别为 "ERROR" 的行的第一列和最后一列（$NF）
awk '/ERROR/ {print $1, $NF}' application.log

# 使用-F指定分隔符，比如CSV文件或用|分隔的日志
awk -F',' '{print $2}' data.csv
```

**2.  `组合使用`（管道符 `|` 是灵魂）**
真正的力量在于组合。

*   **经典组合：实时跟踪并过滤错误**
    ```bash
    tail -f application.log | grep -E "ERROR|Exception"
    ```

*   **查找错误，并查看其前后5行上下文**
    ```bash
    grep -C 5 "CriticalFailure" application.log | less
    ```

*   **统计某个错误出现的次数**
    ```bash
    grep -c "OutOfMemoryError" application.log
    ```

*   **查看今天10点左右的日志**
    ```bash
    grep "2024-05-21 10:" application.log | head -n 20
    ```

### 在 IDEA 等图形化界面中如何操作？

IDEA 提供了强大的图形化功能，原理是相通的。

1.  **打开日志文件**：直接用 IDEA 打开本地日志文件，它会自动语法高亮。
2.  **搜索**：
    *   `Ctrl + F`：当前文件搜索。**IDEA 的搜索框支持正则表达式**，勾选 `.*` (Regex) 即可。
    *   `Ctrl + Shift + F`：全局搜索（Across Files）。可以在整个项目甚至指定目录下搜索所有日志文件。
3.  **过滤（超好用！）**：
    *   打开日志文件后，注意右上角有一个 **“Filter”** 输入框。
    *   在里面输入关键词（如 `ERROR`），IDEA 会**立即动态地只显示包含该关键词的行**，其他行全部隐藏。这不是高亮，是过滤！
    *   同样支持正则表达式。
4.  **导航**：
    *   `F2` / `Shift + F2`：在错误/警告之间跳转。
    *   点击行号旁边的箭头可以折叠/展开堆栈信息。

### 实战决策流程

1.  **看生产/测试环境日志（Linux SSH）**：
    *   首先 `tail -f app.log` 看实时动态。
    *   发现问题后 `Ctrl+C` 停下，然后用 `grep -n "error_keyword" app.log` 定位。
    *   再用 `grep -C 10 [行号附近的关键词]` 查看上下文。
    *   如果需要复杂分析，`scp` 下载日志到本地，用 IDEA 看。

2.  **看本地日志**：
    *   直接用 IDEA 打开，使用 **Filter** 功能快速过滤到错误级别。
    *   用 `Ctrl + F` 搜索特定请求 ID 或用户 ID，追踪完整链路。

记住，核心就是：**不要用眼睛看，用命令过滤**。熟练使用 `grep`, `tail -f`, `less` 和 IDEA 的 Filter，你就能在日志的海洋里轻松航行。