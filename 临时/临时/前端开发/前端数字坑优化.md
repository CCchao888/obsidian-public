å¥½ï¼Œè¿™ä¸€é—®**éå¸¸å…³é”®** ğŸ‘  
æˆ‘ç»™ä½ ä¸€ä¸ª**â€œå¯ä»¥ç›´æ¥è½åœ°åˆ°é¡¹ç›®é‡Œç”¨â€çš„å®Œæ•´æ–¹æ¡ˆ**ï¼Œä»ï¼š

- ä¸ºä»€ä¹ˆè¦æ”¹
    
- æ”¹å“ªäº›åœ°æ–¹
    
- æ¯ä¸ªæ–¹æ³•æ€ä¹ˆå†™
    
- è¿”å›å­—ç¬¦ä¸²è¿˜æ˜¯ number
    
- å‰ç«¯å±•ç¤º / æ ¡éªŒ / å›ä¼ åç«¯æ€ä¹ˆç»Ÿä¸€
    

**å…¨éƒ¨ç»™ä½ ä¸€å¥—é—­ç¯æ–¹æ¡ˆ**ï¼ˆç­‰ä»·äº Java BigDecimal æ€è·¯ï¼‰ã€‚

---

# ä¸€ã€å…ˆç»™ä½ ä¸€ä¸ªã€æ€»è®¾è®¡åŸåˆ™ã€‘

> **åªè¦è¿›å…¥â€œä¸šåŠ¡æ•°å€¼è®¡ç®—åŸŸâ€ï¼Œå°±æ°¸è¿œä¸ç”¨ JS çš„ Number è¿ç®—**

ç»Ÿä¸€åŸåˆ™ï¼š

|é˜¶æ®µ|ç±»å‹|
|---|---|
|åç«¯è¿”å›|**å­—ç¬¦ä¸²**|
|å‰ç«¯è®¡ç®—|**Decimal å®ä¾‹**|
|å±•ç¤º|**å­—ç¬¦ä¸²ï¼ˆtoFixedï¼‰**|
|æ ¡éªŒ|**åŸºäº Decimal çš„ç²¾åº¦åˆ¤æ–­**|
|å›ä¼ åç«¯|**å­—ç¬¦ä¸²**|

ğŸ‘‰ **Number åªç”¨äº UI å±‚ï¼ˆæ¯”å¦‚ v-model ç»„ä»¶è¦æ±‚ï¼‰**

---

# äºŒã€å…ˆå¼•å…¥ decimal.js

```bash
npm install decimal.js
```

### æ¨èå…¨å±€é…ç½®ï¼ˆå¯é€‰ä½†å¼ºçƒˆå»ºè®®ï¼‰

```js
// src/utils/decimal.js
import Decimal from 'decimal.js'

Decimal.set({
  precision: 20,                // è¶³å¤Ÿä¸šåŠ¡ç”¨
  rounding: Decimal.ROUND_HALF_UP // å¯¹é½ BigDecimal å¸¸ç”¨
})

export default Decimal
```

ä»¥åç»Ÿä¸€ä»è¿™é‡Œå¼•ï¼Œ**é¿å…é»˜è®¤é…ç½®ä¸ä¸€è‡´**ã€‚

---

# ä¸‰ã€ä½ ç°åœ¨çš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œå®Œæ•´é‡å†™

## 1ï¸âƒ£ handleRateï¼ˆä¸šåŠ¡å€¼å˜æ¢ï¼‰

### ç›®æ ‡

- ç™¾åˆ†æ¯”è½¬æ¢
    
- ç²¾åº¦å…œåº•ï¼ˆå†å²æ•°æ®ï¼‰
    
- è¿”å› **å­—ç¬¦ä¸²**
    

### æ–°å®ç°

```js
import Decimal from '@/utils/decimal'

/**
 * æ¯”ä¾‹è½¬æ¢ï¼ˆæ ¸å¿ƒä¸šåŠ¡æ–¹æ³•ï¼‰
 * @param {string | number} value åç«¯åŸå§‹å€¼
 * @param {number} factor å˜æ¢å› å­ï¼Œå¦‚ 100 / 0.01
 * @param {number} scale ä¿ç•™å°æ•°ä½ï¼ˆä¸šåŠ¡ç²¾åº¦ï¼‰
 */
export function handleRate(value, factor, scale = 4) {
  if (value == null || value === '') return ''

  try {
    return new Decimal(value)
      .mul(factor)
      .toFixed(scale)   // ç›´æ¥åœ¨è¿™é‡Œâ€œæ¶ˆç­å†å²è„ç²¾åº¦â€
  } catch (e) {
    console.error('handleRate error:', value, factor)
    return ''
  }
}
```

### âœ” ä¸ºä»€ä¹ˆè¿™ä¸€æ­¥æœ€é‡è¦ï¼Ÿ

- æ‰€æœ‰ `56.999999999` **åœ¨è¿™é‡Œè¢«å½»åº•æ¶ˆé™¤**
    
- åé¢æ ¡éªŒ / å±•ç¤º / å›ä¼  **å…¨æ˜¯å¹²å‡€å€¼**
    

---

## 2ï¸âƒ£ roundUpï¼ˆçº¯å±•ç¤ºç”¨ï¼‰

> æ³¨æ„ï¼š**å®ƒä¸å†ä¿®æ­£ç²¾åº¦ï¼Œåªåšå±•ç¤º**

```js
import Decimal from '@/utils/decimal'

/**
 * å±•ç¤ºå±‚æ ¼å¼åŒ–
 */
export function roundUp(value, scale = 2) {
  if (value == null || value === '') return ''

  return new Decimal(value).toFixed(scale)
}
```

---

# å››ã€æ ¡éªŒâ€œæœ€å¤š 4 ä½å°æ•°â€æ€ä¹ˆå†™ï¼ˆé‡ç‚¹ï¼‰

âŒ é”™è¯¯æ–¹å¼ï¼ˆä½ ä¹‹å‰è¸©å‘çš„ï¼‰ï¼š

```js
Number(value) // âŒ æµ®ç‚¹
```

âœ… æ­£ç¡®æ–¹å¼ï¼ˆDecimalï¼‰ï¼š

```js
import Decimal from '@/utils/decimal'

export function validateScale(value, maxScale = 4) {
  const d = new Decimal(value)
  return d.decimalPlaces() <= maxScale
}
```

### ä½¿ç”¨ç¤ºä¾‹

```js
if (!validateScale(rate, 4)) {
  this.$message.error('æœ€å¤šåªèƒ½è¾“å…¥4ä½å°æ•°')
}
```

---

# äº”ã€å›ä¼ åç«¯ï¼ˆæœ€å®¹æ˜“å‡º bug çš„åœ°æ–¹ï¼‰

ä½ ä¹‹å‰æåˆ°ï¼š

> åé¢è¿˜ä¼š `handleRate(v, 0.01)` å†ä¼ ç»™åç«¯

### æ­£ç¡®åšæ³•ï¼ˆå¿…é¡»ç”¨ Decimalï¼‰

```js
export function toBackendRate(value, scale = 6) {
  return new Decimal(value)
    .mul(0.01)
    .toFixed(scale)
}
```

âœ” å¯é€†  
âœ” æ— ç²¾åº¦ä¸¢å¤±  
âœ” å’Œ Java BigDecimal ä¸€è‡´

---

# å…­ã€å®Œæ•´ä½¿ç”¨é“¾è·¯ï¼ˆéå¸¸é‡è¦ï¼‰

### 1ï¸âƒ£ åç«¯è¿”å›

```json
{
  "rate": "0.570000"
}
```

---

### 2ï¸âƒ£ å‰ç«¯åˆå§‹åŒ–

```js
this.form.ratePercent = handleRate(data.rate, 100, 4)
// "57.0000"
```

---

### 3ï¸âƒ£ é¡µé¢å±•ç¤º

```js
roundUp(this.form.ratePercent, 2) + '%'
// "57.00%"
```

---

### 4ï¸âƒ£ ç”¨æˆ·ä¿®æ”¹ â†’ æ ¡éªŒ

```js
validateScale(this.form.ratePercent, 4)
```

---

### 5ï¸âƒ£ æäº¤ç»™åç«¯

```js
payload.rate = toBackendRate(this.form.ratePercent)
// "0.570000"
```

---

# ä¸ƒã€å¦‚æœä½ ç°åœ¨â€œæš‚æ—¶ä¸èƒ½å¼•åº“â€çš„å…œåº•æ–¹æ¡ˆ

æˆ‘ä¹Ÿç»™ä½ ä¸€ä¸ª**è¿‡æ¸¡ç‰ˆæ–¹æ¡ˆ**ï¼ˆä¸æ¨èé•¿æœŸç”¨ï¼‰ï¼š

```js
function handleRate(value, factor) {
  const raw = (Number(value) + Number.EPSILON) * factor
  return raw.toFixed(4) // å¼ºåˆ¶å­—ç¬¦ä¸²
}
```

âš  è¯´æ˜ï¼š

- èƒ½ä¿® 99% æµ®ç‚¹å‘
    
- ä½†**ä¸æ˜¯ç»å¯¹å®‰å…¨**
    
- ä¸é€‚åˆä½ è¿™ç§â€œå†å²æ•°æ® + å›ä¼ â€çš„åœºæ™¯
    

---

# å…«ã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“ï¼ˆä½ ç°åœ¨è¿™ä¸ªé˜¶æ®µå¿…é¡»è®°ä½ï¼‰

> **decimal.js ä¸æ˜¯â€œä¼˜åŒ–â€ï¼Œè€Œæ˜¯â€œä¿®æ­£æ•°æ®æ¨¡å‹â€**

ä½ ç°åœ¨é‡åˆ°çš„é—®é¢˜æœ¬è´¨æ˜¯ï¼š

> âŒ æŠŠâ€œä¸šåŠ¡æ•°å€¼â€å½“æˆäº† JS Number  
> âœ… å®é™…å®ƒåº”è¯¥æ˜¯ BigDecimal

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸®ä½ ï¼š

- æŠŠ **ç°æœ‰ä»£ç ä¸€æ¬¡æ€§è¿ç§» checklist åˆ—å‡ºæ¥**
    
- æˆ–å¸®ä½ è®¾è®¡ **å‰ç«¯é‡‘é¢ / æ¯”ä¾‹ç»Ÿä¸€å·¥å…·ç±»**
    
- æˆ–å¯¹é½ **åç«¯ BigDecimal çš„ scale / rounding ç­–ç•¥**
    

ä½ é€‰ä¸€ä¸ªï¼Œæˆ‘ç»§ç»­ç»™ä½ æ°å¼€æ‰ç¢è®²ã€‚